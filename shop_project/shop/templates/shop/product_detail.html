{% extends 'base.html' %}
{% block title %}{{ product.name }} - –ú–∞–≥–∞–∑–∏–Ω{% endblock %}
{% block content %}
<div class="container my-5">
    <h1 class="mb-4 text-center">{{ product.name }}</h1>

    <div class="row g-4">
        <!-- –§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ -->
        <div class="col-md-6">
            {% if product.photo %}
                <img src="{{ product.photo.url }}" alt="{{ product.name }}" class="img-fluid rounded shadow">
            {% else %}
                <div class="text-muted">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</div>
            {% endif %}
        </div>

        <!-- –û–ø–∏—Å–∞–Ω–∏–µ –∏ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="col-md-6">
            <ul class="list-group mb-4">
                <li class="list-group-item"><strong>üí∞ –¶–µ–Ω–∞:</strong> {{ product.price }} —Ä—É–±.</li>
                <li class="list-group-item"><strong>üìè –†–∞–∑–º–µ—Ä:</strong> {{ product.size }}</li>
                <li class="list-group-item"><strong>üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ product.category.name }}</li>
                <li class="list-group-item"><strong>üè∑ –ö–æ–º–∞–Ω–¥–∞:</strong> {{ product.team.name }}</li>
                <li class="list-group-item"><strong>üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å:</strong> {{ product.manufacturer.name }}</li>
                <li class="list-group-item"><strong>üì¶ –ö–æ–ª–ª–µ–∫—Ü–∏–∏:</strong>
                    {% for collection in product.collection.all %}
                        <span class="badge bg-primary">{{ collection.name }}</span>
                    {% empty %}
                        <span class="text-muted">–ù–µ—Ç</span>
                    {% endfor %}
                </li>
                <li class="list-group-item">
                    <strong>‚úÖ –í –Ω–∞–ª–∏—á–∏–∏:</strong>
                    {% if product.is_available %}
                        <span class="text-success">–î–∞</span>
                    {% else %}
                        <span class="text-danger">–ù–µ—Ç</span>
                    {% endif %}
                </li>
                <li class="list-group-item"><strong>üïí –î–æ–±–∞–≤–ª–µ–Ω:</strong> {{ product.create_date|date:"d.m.Y H:i" }}</li>
            </ul>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
            {% if is_staff %}
                <div class="mb-3 d-flex flex-wrap gap-2">
                    <a href="{% url 'shop:product_update' product.pk %}" class="btn btn-warning">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                    <a href="{% url 'shop:product_delete' product.pk %}" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</a>
                </div>
            {% endif %}

            <!-- –ù–∞–∑–∞–¥ -->
            <a href="{% url 'shop:product_list' %}" class="btn btn-outline-secondary mb-4">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω–æ–π -->
            <div class="d-flex flex-wrap align-items-center gap-3 mb-3">
                {% if cart_item %}
                    <form action="{% url 'cart:add_to_cart' product.id %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="quantity" value="-1">
                        <button type="submit" class="btn btn-outline-secondary">-</button>
                    </form>

                    <span class="fw-bold">–í –∫–æ—Ä–∑–∏–Ω–µ: {{ cart_item.quantity }} —à—Ç</span>

                    <form action="{% url 'cart:add_to_cart' product.id %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="quantity" value="1">
                        <button type="submit" class="btn btn-outline-secondary">+</button>
                    </form>

                    {% if cart_item.quantity <= 1 %}
                        <form action="{% url 'cart:remove' product.id %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline-danger">–£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                    {% endif %}
                {% else %}
                    <form action="{% url 'cart:add_to_cart' product.id %}" method="post" class="d-flex align-items-center gap-2">
                        {% csrf_token %}
                        <input type="number" name="quantity" value="1" min="1" max="100" class="form-control" style="width: 100px;" required>
                        <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
                    </form>
                {% endif %}
            </div>

            {% if not is_authenticated %}
                <div class="alert alert-info mt-3">
                    –ß—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑, <a href="{% url 'shop:login' %}" class="alert-link">–≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</a>.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
